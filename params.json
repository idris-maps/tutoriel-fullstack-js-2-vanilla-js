{
  "name": "Tutoriel-fullstack-js-2-vanilla-js",
  "tagline": "Tutoriel Fullstack JavaScript - Chapitre 2 - Vanilla JS",
  "body": "# \"Vanilla\" JS\r\n\r\nLe javascript \"vanilla\" est une manière de désigner le javascript \"pure\", c'est à dire sans utiliser de scripts externes. On écrit tout le code soi-même sans avoir recours à des librairies ou \"framework\" pour se faciliter la tâche. L'avantage principal, et c'est la raison pour laquelle nous commençons avec ça, est que vous savez exactement ce qui se passe. Il n'y a pas de magie. Par contre il faut écrire un peu plus de code...\r\n\r\n## Mise en place\r\n\r\nCréez un nouveau dossier (je l'appelle ```2.vanilla```) pour le projet et à l'intérieur de celui-ci un dossier ```public``` ou nous mettons les fichiers ```style.css``` et ```index.html``` créés dans le chapitre précèdant.\r\n\r\nOuvrez ```index.html```, supprimez le contenu de la balise ```<div id=\"liste\">```, ajoutez une balise```<script src=\"script.js\"></script>``` avant la fin du corp du document et changez le titre de la balise ```<title>```.\r\n\r\n```\r\n<!doctype html>\r\n<html>\r\n <head>\r\n <meta charset=\"utf-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>\r\n  <title>Vanilla</title>\r\n  <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n  <link rel=\"stylesheet\" href=\"style.css\">\r\n </head>\r\n <body>\r\n<div id=\"contenu\">\r\n <h1>À faire</h1>\r\n <div id=\"liste\"></div>\r\n <div id=\"formulaire\">\r\n  <div class=\"ajouter\">\r\n   <div class=\"ajouter-input\">\r\n    <input id=\"ajouter-input\" class=\"form-control\" placeholder=\"À faire\" type=\"text\">\r\n   </div>\r\n   <div class=\"ajouter-bouton\">\r\n    <button id=\"ajouter-bouton\" class=\"btn btn-primary\">Ajouter</button>\r\n   </div>\r\n  </div>\r\n  <div id=\"supprimer-fait\">\r\n   <button id=\"supprimer-fait-bouton\" class=\"btn btn-danger\">Supprimer ce qui a été fait</button>\r\n  </div>\r\n </div>\r\n</div>\r\n<script src=\"script.js\"></script>\r\n </body>\r\n</html>\r\n```\r\n\r\nDans un terminal, naviguez jusqu'au dossier de votre projet et initialisez NPM\r\n\r\n```\r\n$ cd ~/Desktop/2.vanilla\r\n$ npm init\r\n```\r\n\r\nUn fichier ```package.json``` sera créé. Ouvrez le et ajoutez un script ```build``` pour créer ```public/script.js``` et le minifier. Pour cette opération ```browserify``` et ```minify``` doivent avoir été installés globalement. Voir l'[introduction](link_to_do) de ce cette série.\r\n\r\n```\r\n{\r\n \"name\": \"2.vanilla\",\r\n \"version\": \"1.0.0\",\r\n \"description\": \"\",\r\n \"main\": \"index.js\",\r\n \"scripts\": {\r\n  \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\r\n  \"build\": \"browserify main.js -o public/script.js | minify public/script.js -o public/script.js\"\r\n },\r\n \"author\": \"\",\r\n \"license\": \"ISC\"\r\n}\r\n```\r\n\r\n```browserify``` crée le fichier ```public/script.js``` contenant ```main.js``` et toutes ses dépendences. ```minify``` comme son nom l'indique le minifie. ```public/script.js``` est maintenant presque illisible mais se chargera plus rapidement.\r\n\r\nCréez un fichier ```main.js``` et un dossier ```lib``` à la racine de votre projet. Votre dossier doit maintenant avoir cette structure:\r\n\r\n```\r\nvanilla\r\n -lib\r\n -public\r\n  index.html\r\n  style.css\r\n main.js\r\n package.json\r\n```\r\n\r\n## Le modèle\r\n\r\nDans le dossier ```lib```, créez un fichier ```Modele-a-faire.js```.\r\n\r\nIl est commun de nommer les fonctions \"constructeurs\" (plus d'infos [ici](https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Function)) avec une majuscule.\r\n\r\nOuvrez le fichier, créez un module et liez le contexte ```this``` à une variable ```ctx```. Comme le contexte peut changer à l'intérieur d'une autre fonction, il vaut mieux le lier à une variable plutôt qu'utiliser ```this``` qui peut soudain se réferer à un autre contexte.\r\n\r\n```\r\nmodule.exports = function() {\r\n var ctx = this\r\n}\r\n```\r\n\r\nLes choses à faire seront contenues dans un dictionnaire ```data```. Nous en ajoutons déjà deux: \"manger\" et \"dormir\". On va dire que \"manger\" c'est fait et que \"dormir\" reste à faire.\r\n\r\n```\r\nmodule.exports = function() {\r\n var ctx = this\r\n ctx.data = [\r\n  {text: \"Manger\", fait: true},\r\n  {text: \"Dormir\", fait: false}\r\n ]\r\n}\r\n```\r\n\r\nNous allons maintenant ajouter quelques méthodes pour modifier le dictionnaire.\r\n\r\n### Ajouter quelque chose à faire\r\n\r\n```\r\nctx.ajouter = function(text) {\r\n ctx.data.push({text: text, fait: false})\r\n}\r\n```\r\n\r\nLa fonction ```.ajouter()``` prends une valeur ```text``` et ajoute un objet au dictionnaire. Par défaut, on va dire que ce n'est pas encore fait. Sinon il n'y a aucune raison de l'ajouter.\r\n\r\n### Basculer fait\r\n\r\nLa clé ```fait``` des objets du dictionnaire est un booléen qui est soit ```true``` (vrai), soit ```false``` (faux). Nous allons créer une fonction qui prends l'```index``` de l'object dans le dictionnaire et qui changera la clé ```fait``` de l'objet en question.\r\n\r\n```\r\nctx.basculerFait = function(index) {\r\n if(ctx.data[index].fait) { ctx.data[index].fait = false }\r\n else { ctx.data[index].fait = true }\r\n}\r\n```\r\n\r\n### Mettre à jour\r\n\r\nNous voulons pouvoir changer le contenu du texte d'un objet. Pour cela nous créons une fonction qui prends l'```index``` et le nouveau ```text```.\r\n\r\n```\r\nctx.mettreAJour = function(index, text) {\r\n ctx.data[index].text = text\r\n}\r\n```\r\n\r\n### Supprimer fait\r\n\r\nNous voulons également pouvoir supprimer tous les objets marqués comme fait.\r\n\r\n```\r\nctx.supprimerFait = function() {\r\n var aGarder = []\r\n ctx.data.forEach(function(element) {\r\n  if(!element.fait) { aGarder.push(element) }\r\n })\r\n ctx.data = aGarder\r\n}\r\n```\r\n\r\nIci nous créons un nouveau dictionnaire ```aGarder``` et y ajoutons les objets dont la clé ```fait``` est ```false```. Finalement nous remplaçons l'ancien dictionnaire ```ctx.data``` par ```aGarder```.\r\n\r\n### Tout ensemble\r\n\r\nNous avons maintenant un modèle avec les méthodes dont nous avons besoin pour le modifier. \r\n\r\nLe fichier ```Modele-a-faire.js``` resemble à ça:\r\n\r\n```\r\nmodule.exports = function() {\r\n var ctx = this\r\n ctx.data = [\r\n  {text: 'Manger', fait: true},\r\n  {text: 'Dormir', fait: false}\r\n ]\r\n ctx.ajouter = function(text) {\r\n  ctx.data.push({text: text, fait: false})\r\n }\r\n ctx.basculerFait = function(index) {\r\n  if(ctx.data[index].fait) { ctx.data[index].fait = false }\r\n  else { ctx.data[index].fait = true }\r\n }\r\n ctx.mettreAJour = function(index, text) {\r\n  ctx.data[index].text = text\r\n }\r\n ctx.supprimerFait = function() {\r\n  var aGarder = []\r\n  ctx.data.forEach(function(element) {\r\n   if(!element.fait) { aGarder.push(element) }\r\n  })\r\n  ctx.data = aGarder\r\n }\r\n}\r\n```\r\n\r\n## La vue\r\n\r\nCette partie est la plus difficile à faire proprement sans utiliser une librairie \"patron\" (\"template\" en anglais). La technique que nous allons utiliser ici consiste à créer une chaîne de caractères HTML et à l'intégrer dans la balise ```<div id=\"liste\">``` en remplaçant son contenu. Il n'est généralement pas recommandé de mélanger HTML et javascript de cette manière. Dans le prochain chapitre nous utiliserons une librairie \"patron\". Le but ici est de comprendre comment ça fonctionne et de ne pas utiliser de scriptes externes.\r\n\r\nDans le dossier ```lib```, créez un fichier ```vue-a-faire.js``` et ouvrez-le.\r\n\r\n### Créer un élément de la liste\r\n\r\nNous allons en premier créer une fonction qui renvoit un élément de la liste. Comme nous avons vu précedemment celui-ci est différent selon qu'il soit ```fait``` ou non et selon qu'il soit en cours de modification ou pas.  \r\n\r\n```\r\nfunction creerHtmlElement(element) {\r\n if(element.fait) {\r\n  var classeFaitOuNon = 'fait'\r\n  var iconeBasculerFait = 'remove'\r\n } else {\r\n  var classeFaitOuNon = 'a-faire'\r\n  var iconeBasculerFait = 'ok'\r\n }\r\n var htmlEl = '<div class=\"liste-element ' + classeFaitOuNon + '\">'\r\n  + '<div class=\"liste-element-info\">'\r\n   + '<div class=\"liste-element-texte\">'\r\n    + '<p>' + element.text + '</p>'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-modif\">'\r\n    + '<span class=\"glyphicon glyphicon-pencil\"></span>'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-statut\">'\r\n    + '<span class=\"glyphicon glyphicon-' + iconeBasculerFait + '\"></span>'\r\n   + '</div>'\r\n  + '</div>'\r\n\r\n if(element.maj) {\r\n  htmlEl = htmlEl + '<div class=\"liste-element-maj\">'\r\n   + '<div class=\"liste-element-maj-input\">'\r\n    + '<input class=\"form-control\" id=\"liste-element-maj-input\" type=\"text\">'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-maj-bouton\">'\r\n    + '<button class=\"btn btn-primary\" id=\"liste-element-maj-bouton\">OK</button>'\r\n   + '</div>'\r\n  + '</div>'\r\n }\r\n\r\n return htmlEl + '</div>'\r\n}\r\n```\r\n\r\nNous créons deux variables qui seront différentes si la chose a été faite ou pas:\r\n\r\n* ```classeFaitOuNon```: la classe CSS qui définit le fond de couleur de la ```<div>```\r\n* ```iconeBasculerFait```: l'icône Bootstrap du bouton\r\n\r\nPuis nous créons la chaîne de caractères HTML en incluant la clé ```text``` de l'élément. C'est la partie ```element.text```.\r\n\r\nSi l'élément est en cours de mise à jour, nous ajoutons une ```<div class=\"liste-element-maj\">```.\r\n\r\nFinalement la fonction retourne la chaîne de caractères HTML ainsi créée.\r\n\r\n### Créer la liste\r\n\r\nNotre prochaine fonction crée une chaîne de caractères vide, puis y ajoute le HTML de chaque élément du dictionnaire ```modele.data``` en invoquant la fonction ```creerHtmlElement()```. Finalement elle retourne le HTML complet de la liste.\r\n\r\n```\r\nfunction creerHtml(modele) {\r\n var html = ''\r\n modele.data.forEach(function(element) {\r\n  html = html + creerHtmlElement(element)\r\n })\r\n return html\r\n}\r\n```\r\n\r\n### Créer le module\r\n\r\nPour finir nous créons un module exportable qui prends le ```modele``` comme argument, invoque ```creerHtml()``` pour avoir le contenu de la liste et l'ajoute à la balise ```<div id=\"liste\">```.\r\n\r\nLe fichier ```vue-a-faire.js``` en entier:\r\n\r\n```\r\nmodule.exports = function(modele) {\r\n document.getElementById('liste').innerHTML = creerHtml(modele)\r\n}\r\n\r\nfunction creerHtml(modele) {\r\n var html = ''\r\n modele.data.forEach(function(element) {\r\n  html = html + creerHtmlElement(element)\r\n })\r\n return html\r\n}\r\n\r\nfunction creerHtmlElement(element) {\r\n if(element.fait) {\r\n  var classeFaitOuNon = 'fait'\r\n  var iconeBasculerFait = 'remove'\r\n } else {\r\n  var classeFaitOuNon = 'a-faire'\r\n  var iconeBasculerFait = 'ok'\r\n }\r\n var htmlEl = '<div class=\"liste-element ' + classeFaitOuNon + '\">'\r\n  + '<div class=\"liste-element-info\">'\r\n   + '<div class=\"liste-element-texte\">'\r\n    + '<p>' + element.text + '</p>'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-modif\">'\r\n    + '<span class=\"glyphicon glyphicon-pencil\"></span>'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-statut\">'\r\n    + '<span class=\"glyphicon glyphicon-' + iconeBasculerFait + '\"></span>'\r\n   + '</div>'\r\n  + '</div>'\r\n\r\n if(element.maj) {\r\n  htmlEl = htmlEl + '<div class=\"liste-element-maj\">'\r\n   + '<div class=\"liste-element-maj-input\">'\r\n    + '<input class=\"form-control\" id=\"liste-element-maj-input\" type=\"text\">'\r\n   + '</div>'\r\n   + '<div class=\"liste-element-maj-bouton\">'\r\n    + '<button class=\"btn btn-primary\" id=\"liste-element-maj-bouton\">OK</button>'\r\n   + '</div>'\r\n  + '</div>'\r\n }\r\n\r\n return htmlEl + '</div>'\r\n}\r\n```\r\n\r\n## Les controleurs\r\n\r\nNous avons un modèle et une vue, il faut maintenant faire les controleurs qui permettent de modifier le modèle en interagissant avec la vue.\r\n\r\nNotre page a deux parties:\r\n\r\n* La liste (qui sera réactualisée à chaque modification)\r\n* Le formulaire (qui ne changera pas)\r\n\r\nQuand la liste est réactualisée, il nous faudra ajouter à nouveau tous les controleurs. En revanche, pour la partie \"formulaire\", nous n'avons besoin d'ajouter des controleurs qu'une fois, quand la page est chargée. Il nous faut donc deux fonctions \"controleurs\" que nous appelerons ```.creer()``` et ```.rafraichir()```. Comme les deux fonctions ont pour but d'interagir avec le modèle, elle prendront les deux un argument ```modele```.\r\n\r\nDans ```lib```, créez un fichier ```controleurs-a-faire.js``` exportant ces deux fonctions.\r\n\r\n```\r\nexports.creer = function(modele) {\r\n\r\n} \r\n\r\nexports.rafraichir = function(modele) {\r\n\r\n}\r\n``` \r\n\r\nCommençons par les controleurs qui seront activés uniquement lors du chargement de la page:\r\n\r\n* Ajouter quelque chose à faire\r\n* Supprimer ce qui a été fait\r\n\r\n```\r\nexports.creer = function(modele) {\r\n ajouter(modele)\r\n supprimerFait(modele)\r\n} \r\n```\r\n\r\nPar souci de clarté nous allons créer un nouveau fichier pour chaque contrôleur. Dans le dossier ```lib```, créez un nouveau dossier ```controleurs-a-faire``` avec deux fichiers:\r\n\r\n* ```ajouter.js```\r\n* ```supprimer-fait.js```\r\n\r\nDans ```controleurs-a-faire.js```, nous ajoutons un lien vers ces deux fichiers en haut de la page.\r\n\r\n```\r\nvar ajouter = require('./controleurs-a-faire/ajouter')\r\nvar supprimerFait = require('./controleurs-a-faire/supprimer-fait')\r\n\r\nexports.creer = function(modele) {\r\n ajouter(modele)\r\n supprimerFait(modele)\r\n} \r\n\r\nexports.rafraichir = function(modele) {\r\n\r\n}\r\n```\r\n\r\n### ```ajouter.js```\r\n\r\n```\r\nmodule.exports = function(modele) {\r\n var input = document.getElementById('ajouter-input')\r\n var btn = document.getElementById('ajouter-bouton')\r\n btn.onclick = function() {\r\n  if(input.value) {\r\n   modele.ajouter(input.value)\r\n   input.value = ''\r\n  }\r\n }\r\n}\r\n```\r\n\r\nCe controleur utilise deux éléments de la page: la balise ```<input id=\"ajouter-input\">``` et le bouton ```<button id=\"ajouter-bouton\">```, nous les référençons par deux variables ```input``` et ```btn```. Quand ```btn``` est clické, si ```input``` n'est pas vide, nous invoquons la méthode ```.ajouter()``` du modèle. Puis ```input``` est remis à zéro.\r\n\r\nNous avons modifié le modèle mais la liste n'est pas actualisée. Comme nous allons devoir réactualiser la liste à chaque modification, nous avons besoin d'une fonction qui s'en chargera.\r\n\r\n### ```rafraichir.js```\r\n\r\nDans ```lib/controleurs-a-faire```, créez un fichier ```rafraichir.js```:\r\n\r\n```\r\nvar vue = require('../vue-a-faire')\r\nvar controleurs = require('../controleurs-a-faire')\r\n\r\nmodule.exports = function(modele) {\r\n vue(modele)\r\n controleurs.rafraichir(modele)\r\n}\r\n```\r\n\r\nCette fonction invoquera la vue et rafraîchira les controleurs qui auront besoin de l'être (la fonction ```.rafraichir()``` de ```controleurs-a-faire.js``` qui est encore vide).\r\n\r\nRetournez à ```ajouter.js``` et appelez la fonction ```.rafraichir()``` une fois le modèle modifié.\r\n\r\n```\r\nvar rafraichir = require('./rafraichir') // <-- nouveau\r\n\r\nmodule.exports = function(modele) {\r\n var input = document.getElementById('ajouter-input')\r\n var btn = document.getElementById('ajouter-bouton')\r\n btn.onclick = function() {\r\n  if(input.value) {\r\n   modele.ajouter(input.value)\r\n   input.value = ''\r\n   rafraichir(modele) // <-- nouveau\r\n  }\r\n }\r\n}\r\n```\r\n\r\n### ```supprimer-fait.js```\r\n\r\nOuvrez le fichier ```supprimer-fait.js``` dans le dossier ```lib/controleurs-a-faire```.\r\n\r\n```\r\nvar rafraichir = require('./rafraichir')\r\n\r\nmodule.exports = function(modele) {\r\n var btn = document.getElementById('supprimer-fait-bouton')\r\n btn.onclick = function() {\r\n  modele.supprimerFait()\t\r\n  rafraichir(modele)\r\n }\r\n}\r\n```\r\n\r\nCette fonction lie la balise ```<button id=\"supprimer-fait-bouton\">``` à une variable ```btn```. Quand ```btn``` est clické, la méthode ```.supprimerFait()``` du modèle est invoquée puis la vue est rafraîchie.\r\n\r\nPassons maintenant aux controleurs de la liste. Ceux qui vont devoir être rafraîchis à chaque fois que la vue est mise à jour. \r\n\r\n### ```basculer-fait.js```\r\n\r\nCréez un fichier ```basculer-fait.js``` dans ```lib/controleurs-a-faire```\r\n\r\n```\r\nvar rafraichir = require('./rafraichir')\r\n\r\nmodule.exports = function(modele) {\r\n var btns = document.getElementsByClassName('liste-element-statut')\r\n for(i=0;i<btns.length;i++) {\r\n  var index = i\r\n  var btn = btns[i]\r\n  ajouterEvenement(modele, btn, index)\r\n }\r\n}\r\n\r\nfunction ajouterEvenement(modele, btn, index) {\r\n btn.addEventListener('click', function() {\r\n  modele.basculerFait(index)\r\n  rafraichir(modele)\r\n })\r\n}\r\n```\r\n\r\nCette fonction référence toutes les balises ```<div class=\"liste-element-statut\">``` dans une variable ```btns``` et pour chacune d'entre elles y ajoute un événement ```click``` qui invoque la méthode ```.basculerFait()``` du modèle puis rafraîchit la liste.\r\n\r\nDans ```controleurs-a-faire.js``` nous ajoutons ce controleur aux deux fonctions puisqu'on en aura besoin lors du chargement de la page, ```.creer```, et lorsque la liste est rafraîchie, ```.rafraichir```.\r\n\r\n```\r\nvar ajouter = require('./controleurs-a-faire/ajouter')\r\nvar supprimerFait = require('./controleurs-a-faire/supprimer-fait')\r\nvar basculerFait = require('./controleurs-a-faire/basculer-fait')  // <-- nouveau\r\n\r\nexports.creer = function(modele) {\r\n ajouter(modele)\r\n supprimerFait(modele)\r\n basculerFait(modele) // <-- nouveau\r\n} \r\n\r\nexports.rafraichir = function(modele) {\r\n basculerFait(modele) // <-- nouveau\r\n}\r\n```\r\n\r\nIl ne nous reste plus qu'à ajouter la possibilité de mettre à jour la clé ```text``` du modèle. Pour cela nous avons besoin d'ajouter un formulaire à l'élément de la liste que nous souhaitons modifier. \r\n\r\n### ```basculer-maj.js```\r\n\r\nCréez un fichier ```basculer-maj.js``` dans ```lib/controleurs-a-faire```\r\n\r\n```\r\nvar rafraichir = require('./rafraichir')\r\n\r\nmodule.exports = function(modele) {\r\n var btns = document.getElementsByClassName('liste-element-modif')\r\n for(i=0;i<btns.length;i++) {\r\n  var index = i\r\n  var btn = btns[i]\r\n  ajouterEvenement(modele, btn, index)\r\n }\r\n}\r\n\r\nfunction ajouterEvenement(modele, btn, index) {\r\n btn.addEventListener('click', function() {\r\n  if(modele.data[index].maj) { \r\n   modele.data[index].maj = undefined\r\n   rafraichir(modele)\r\n  } else {\r\n   modele.data.forEach(function(element) { if(element.maj) { element.maj = undefined } })\r\n   modele.data[index].maj = true\r\n   rafraichir(modele)\r\n  }\r\n })\r\n}\r\n```\r\n\r\nCe controleur référence toutes les balises ```<div class=\"liste-element-modif\">``` dans une variable ```btns``` et pour chacune d'entre elles y ajoute un événement ```click``` qui ajoute une clé ```maj``` à l'objet du modèle que nous souhaitons mettre à jour. Pour que nous puissions n'en mettre à jour qu'un seul à la fois, les clés ```maj``` de tous les objets est marquée comme ```undefined```. Sauf celle qui nous intéresse.\r\n\r\nAjoutons le controleur à ```controleurs-a-faire.js```\r\n\r\n```\r\nvar ajouter = require('./controleurs-a-faire/ajouter')\r\nvar supprimerFait = require('./controleurs-a-faire/supprimer-fait')\r\nvar basculerFait = require('./controleurs-a-faire/basculer-fait')  \r\nvar basculerMaj = require('./controleurs-a-faire/basculer-maj') // <-- nouveau\r\n\r\nexports.creer = function(modele) {\r\n ajouter(modele)\r\n supprimerFait(modele)\r\n basculerFait(modele)\r\n basculerMaj(modele) // <-- nouveau\r\n} \r\n\r\nexports.rafraichir = function(modele) {\r\n basculerFait(modele)\r\n basculerMaj(modele) // <-- nouveau\r\n}\r\n```\r\n\r\n### ```mettre-a-jour.js```\r\n\r\nFinalement nous avons besoin d'un controleur pour mettre à jour l'objet quand le formulaire de mise à jour est visible. Créez un fichier ```mettre-a-jour.js``` dans ```lib/controleurs```.\r\n\r\n```\r\nvar rafraichir = require('./rafraichir')\r\n\r\nmodule.exports = function(modele) {\r\n var maj = false\r\n var index = null \r\n modele.data.forEach(function(element, indexElement) {\r\n  if(element.maj) { \r\n   maj = true \r\n   index = indexElement\r\n  }\r\n })\r\n\r\n if(maj) {\r\n  var input = document.getElementById('liste-element-maj-input')\r\n  var btn = document.getElementById('liste-element-maj-bouton')\r\n  btn.onclick = function() {\r\n   if(input.value) {\r\n    modele.mettreAJour(index, input.value)\r\n    modele.data[index].maj = undefined\r\n    input.value = ''\r\n    rafraichir(modele)\r\n   }\r\n  }\r\n }\r\n}\r\n```\r\n\r\nCe controleur vérifie si un des objets du modèle a la clé ```maj``` marquée ```true```. Si c'est le cas, elle en garde l'index. Les balises ```<input id=\"liste-element-maj-input\">``` et ```<button id=\"liste-element-maj-bouton\">``` sont référencées par les variables ```input``` et ```btn```. Quand ```btn``` est clické, si la valeur d'```input``` n'est pas vide, la méthode ```.mettreAJour()``` du modèle est invoquée, la clé ```maj``` est marquée comme ```undefined```, la valeur de ```input``` est mise à zéro et la liste rafraîchie.\r\n\r\nAjoutons ce dernier controleur à ```controleurs-a-faire.js```\r\n\r\n```\r\nvar ajouter = require('./controleurs-a-faire/ajouter')\r\nvar supprimerFait = require('./controleurs-a-faire/supprimer-fait')\r\nvar basculerFait = require('./controleurs-a-faire/basculer-fait')  \r\nvar basculerMaj = require('./controleurs-a-faire/basculer-maj')\r\nvar mettreAJour = require('./controleurs-a-faire/mettre-a-jour') // <-- nouveau\r\n\r\nexports.creer = function(modele) {\r\n ajouter(modele)\r\n supprimerFait(modele)\r\n basculerFait(modele)\r\n basculerMaj(modele) \r\n} \r\n\r\nexports.rafraichir = function(modele) {\r\n basculerFait(modele)\r\n basculerMaj(modele)\r\n mettreAJour(modele) // <-- nouveau\r\n}\r\n```\r\n\r\nIl n'y a pas besoin de l'ajouter à ```.creer()``` puisqu'il n'y a rien à mettre à jour au moment du chargement de la page. Ceci ne peut être fait que quand ```basculerMaj()``` a été invoqué.\r\n\r\n## Tout mettre ensemble\r\n\r\nDans le fichier ```main.js``` à la racine du dossier du projet, nous allons maintenant créer:\r\n\r\n* le modèle\r\n* la vue \r\n* les controleurs\r\n\r\n```\r\nvar Modele = require('./lib/Modele-a-faire')\r\nvar vue = require('./lib/vue-a-faire')\r\nvar controleurs = require('./lib/controleurs-a-faire')\r\n\r\nvar modele = new Modele()\r\nvue(modele)\r\ncontroleurs.creer(modele)\r\n```\r\n\r\nOuvrez le terminal dans le dossier du projet et lancez le script ```build``` pour créer ```public/script.js``` et ouvrez ```index.html``` dans un navigateur.\r\n\r\nVoilà pour la version ```vanilla``` de notre application. Cette approche est un peu laborieuse mais en écrivant tout le code nous-mêmes, nous avons une idée de ce qui ce passe dans une application de type MVC. Nous pouvons maintenant utiliser des scripts écrits par d'autres en connaissance de cause. C'est ce que nous allons faire dans les prochains chapitres.\r\n\r\n \r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}